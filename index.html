<!DOCTYPE html>
<html>
  <head>
    <title>Covid-19 Curitiba</title>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
    <style type="text/css">
    	body {	
		  font-family: Helvetica Neue, Arial, sans-serif;
		  text-align: center;
		}
		.jumbotron {
         	padding: 2rem 1rem; 
         	background-color: transparent;
    	}
		.wrapper {
		  max-width: 800px;
		  margin: 50px auto;
		}
		h1 {
		  font-weight: 200;
		  font-size: 3em;
		  margin: 0 0 0.1em 0;
		}
		h2 {
		  font-weight: 200;
		  font-size: 0.9em;
		  margin: 0 0 50px;
		  color: #999;
		}
		a {
		  margin-top: 50px;
		  display: block;
		  color: #3e95cd;
		}
		ul{
			text-align: left;
			padding: 1em;
		}
		li{
			padding: 0.25em;
		}
    </style>
  </head>
  <body>
  	<div class="jumbotron text-center">
	  <h1><img alt="PUCPR" style="width:280px;height:auto;" title="PUCPR" src="https://www.iasp.ws/media/imagegenerator/290x290/upscale(false)/canvascolor(0xffffffff)/2017_07_31-Pucpr.png">
	  </h1>
	</div>
    <div class="wrapper">
      <h1>Casos Confirmados</h1>
      <h2>Número de casos confirmados de covid-19 em Curitiba 2020</h2>
      <canvas id="confirmados" width="1600" height="900" bcolor="#8a9ae6"></canvas>
    </div>
	
	<div class="wrapper">
      <h1>Número de Óbitos</h1>
      <h2>Número de óbitos confirmados por covid-19 em Curitiba 2020</h2>
      <canvas id="obitos" width="1600" height="900" bcolor="#d64119"></canvas>
    </div>
    
    <div class="wrapper">
      <h1>Pessoas Recuperadas</h1>
      <h2>Número de pessoas curadas do covid-19 em Curitiba 2020</h2>
      <canvas id="recuperados" width="1600" height="900" bcolor="#479c81"></canvas>
    </div>    

    <div class="wrapper">
      <h1>rt</h1>
      <h2>Taxa de transmissão do covid-19 em Curitiba 2020</br>Métrica computada de acordo com Bettencourt and Ribeiro (2008)</h2>
      <canvas id="rt" width="1600" height="900" bcolor="#ec5d04"></canvas>
    </div>
    <div class="wrapper">
      <h1>rt</h1>
      <h2>Taxa de transmissão do covid-19 em Curitiba 2020</br>Métrica computada de acordo com Thompson et al. (2019)</h2>
      <canvas id="rt_thompson" width="1600" height="900" bcolor="#ec5d04"></canvas>
    </div>
    <div class="wrapper">
      <h1>Previsão de Casos Totais</h1>
      <h2>Previsão do número de casos em Curitiba</h2>
      <canvas id="previsao" width="1600" height="900" bcolor="#00ff00"></canvas>
    </div> 
    <div class="wrapper">
      <h1>Previsão de Novos Casos Diários</h1>
      <h2>Previsão de novos casos diários em Curitiba</h2>
      <canvas id="previsao_diario" width="1600" height="900" bcolor="#00ff00"></canvas>
    </div> 
    <div class="wrapper">
      	<h1>Equipe Responsável:</h1>
      	<ul>
      		<li>Profa. Dra. Cristina Baena - PPGCS</li>
      		<li>Prof. Dr. Emerson Cabrera Paraiso - PPGIa</li>
      		<li>Prof. Dr. Fabio Duarte - PPGTU</li>
      		<li>Prof. Dr. Rodrigo Firmino – PPGTU</li>
      		<li>Profa. Dra. Paula Trevilatto – PRPPI</li>
      	</ul>
      	<h1>Colaboradores:</h1>
      	<ul>
	      	<li>Prof. Dr. Jean Paul Barddal - PPGIa</li>
	      	<li>Luiz Bernardo Kummer - doutorando PPGIa</li>
	      	<li>Matheus Camilo da Silva - mestrando PPGIa</li>
      	</ul>
  	</div>  
    <script type="text/javascript">
    	consulta("confirmados")
    	consulta("obitos")
    	consulta("recuperados")
    	consulta_rt("rt","1")
    	consulta_rt("rt_thompson","2")
    	consulta_previsao("previsao")
    	consulta_previsao_diario("previsao_diario")

		function drawChart(campo, dataset){
			var ctx = document.getElementById(campo);
			var borderColor = ctx.getAttribute("bcolor");
			var myChart = new Chart(ctx, {
		  	type: 'line',
		  	data: {
		    	labels: dataset.datas,
		    	datasets: [
		      	{	 
			        data: dataset[campo],
			        label: `${campo} em Curitiba`,
			        borderColor,
			        fill: false
		      	},
		    	]
		  	}
			});
		}

		function drawChartRT(campo, dataset){
			var ctx = document.getElementById(campo);
			var borderColor = ctx.getAttribute("bcolor");
			var myChart = new Chart(ctx, {
		  	type: 'line',
		  	data: {
		    	labels: dataset.datas,
		    	datasets: [
		      	{	 
			        data: dataset.valor,
			        label: `RT em Curitiba`,
			        borderColor,
			        fill: false
		      	},
		      	{	 
			        data: dataset.acima_95,
			        label: `Margem acima 95%`,
			        borderColor: "#b19cd9",
			        fill:'-1',
		         	order: 4,
		         	pointRadius:0
		      	},
		      	{	 
			        data: dataset.abaixo_95,
			        label: `Margem abaixo 95%`,
			        borderColor: "#b19cd9",
			        fill:'-2',
		         	order: 4,
		         	pointRadius:0
		      	}
		    	]
		  	},
		  	options: {
			scales: {
				yAxes: [{
					ticks: {
						beginAtZero: true,
						stepSize: 1,
					},
				}]
			},
			}
			});
		}

		function drawChartPrevisao(dataset, campo){
			var ctx = document.getElementById(campo);
			var borderColor = ctx.getAttribute("bcolor");
			var myChart = new Chart(ctx, {
		  	type: 'line',
		  	data: {
		    	labels: dataset.datas,
		    	datasets: [
		      	{	 
			        data: dataset.num_casos_funcao,
			        label: `Tendência dos dados`,
			        borderColor,
			        fill: false,
			        order: 1
		      	},
		      	{	 
			        data: dataset.num_casos,
			        label: `Número de casos em Curitiba`,
			        borderColor: "#000",
			        fill: true,
			        backgroundColor:"#000",
		         	showLine: false, 
		         	order: 2
		      	},
		      	{	 
			        data: dataset.m_erro,
			        label: `Previsão próximos 7 dias`,
			        borderColor: "#ff0000",
			        fill:false,
		         	order: 3
		      	},
		      	{	 
			        data: dataset.acima_95,
			        label: `Margem acima 95%`,
			        borderColor: "#b19cd9",
			        fill:'-1',
		         	order: 4,
		         	pointRadius:0
		      	},
		      	{	 
			        data: dataset.abaixo_95,
			        label: `Margem abaixo 95%`,
			        borderColor: "#b19cd9",
			        fill:'-2',
		         	order: 4,
		         	pointRadius:0
		      	}
		    	]
		  	},

			});
		}
		async function consulta_rt(campo, tipo){
		  try {
		    const response = await axios.get('https://covid-19-puc-dashboard.herokuapp.com/consulta_rt/'+tipo);
		    // const response = await axios.get('http://localhost:8080/consulta_rt/'+tipo);
		    console.log('RT:'+response.data)
		    drawChartRT(campo, response.data)
		  } catch (error) {
		    console.error(error);
		  }}

		async function consulta_previsao(campo){
		  try {
		    const response = await axios.get('https://covid-19-puc-dashboard.herokuapp.com/previsao/');
		    // const response = await axios.get('http://localhost:8080/previsao');
		    console.log(response.data)
		    drawChartPrevisao(response.data, campo)
		  } catch (error) {
		    console.error(error);
		  }}

		async function consulta_previsao_diario(campo){
		  try {
		    const response = await axios.get('https://covid-19-puc-dashboard.herokuapp.com/previsao_diario/');
		    // const response = await axios.get('http://localhost:8080/previsao_diario');
		    console.log(response.data)
		    drawChartPrevisao(response.data, campo)
		  } catch (error) {
		    console.error(error);
		  }}  
		async function consulta(campo){
		  try {
		    // const response = await axios.get('http://localhost:8080/consulta/'+campo);
		    const response = await axios.get('https://covid-19-puc-dashboard.herokuapp.com/consulta/'+campo);
		    console.log(response.data)
		    drawChart(campo, response.data)
		  } catch (error) {
		    console.error(error);
		  }}
    </script>
  </body>
</html>
